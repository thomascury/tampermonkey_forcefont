// ==UserScript==
// @name         Force Font - JetBrains Mono
// @namespace    https://github.com/thomascury
// @version      0.10
// @description  Force website fonts to JetBrains Mono, tries to preserve icons
// @author       You
// @homepage     https://github.com/thomascury/tampermonkey_forcefont
// @updateURL    https://raw.githubusercontent.com/thomascury/tampermonkey_forcefont/refs/heads/main/userscript_forcefont
// @downloadURL  https://raw.githubusercontent.com/thomascury/tampermonkey_forcefont/refs/heads/main/userscript_forcefont
// @match        *://*/*
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @resource     MonoFont https://fonts.googleapis.com/css?family=JetBrains+Mono:wght@400;700&display=swap
// @resource     SymbolsFont https://fonts.googleapis.com/css?family=Noto+Emoji:wght@400;700&display=swap
// @run-at       document-start
// ==/UserScript==

(function() {
    'use strict';

    // Load Mono & Symbols fonts
    var MonoFont = GM_getResourceText("MonoFont");
    var SymbolsFont = GM_getResourceText("SymbolsFont");
    GM_addStyle(MonoFont);
    GM_addStyle(SymbolsFont);

    // Define the new font family
    let newFont = '"JetBrains Mono", "Noto Emoji", sans-serif';

    // Whitelist of classes and elements to ignore
    let whitelist = [
        '.fa', '.fas', '.far', '.fal', '.fad', // Awesome font
        '.material-icons', // Material icons
        '.katex', '.MathJax', // Math equations
        '.icon-font-chess', // Chess icons
        '.google-symbols', // Google icons/class
        'i', // Icons elements
        '.docon', // MS documentation docon icons
        'code', 'pre', // Code snippets
        "[class*='heroButton']", // Sharepoint HeroButton_* class
        "[class*='vjs-']", // Video Player icons/buttons vjs-* class
    ].join(', ');


    // Create a style element
    let style = document.createElement('style');
    style.type = 'text/css';
    style.innerHTML = `
        body, p, span, a, li, h1, h2, h3, h4, h5, h6, div :not(${whitelist}){
            font-family: ${newFont};
            line-height: 1.2;
        }

        // Force back icon font because the inheritance is breaking the font when outer elements is forced to Mono/Symbols font by the script
        body, p, span, a, li, h1, h2, h3, h4, h5, h6, div [class*="heroButton"] {
            font-family: "FabricMDL2Icons";
        }

        textarea, code, tt, pre {
        }

        .post-text, .wmd-preview {
            ul, ol {
                li {
                    margin-bottom: 0;
                }
            }
        }
    `;

    // Insert the style element into the document
    document.head.appendChild(style);

    // Optional: Log to console that the script has run
    console.log('Fonts forced to JetBrains Mono');
})();
